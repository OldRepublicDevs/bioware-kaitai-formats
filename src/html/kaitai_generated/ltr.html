
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <title>Ltr format specification</title>
  </head>
  <body>
           <div class="container">
  <h1>Ltr format specification</h1>

      
<a name='type-ltr'></a>
<h1>Type: Ltr</h1>

<p>LTR (Letter) resources store third-order Markov chain probability tables that the game uses
to procedurally generate NPC names. The data encodes likelihoods for characters appearing at
the start, middle, and end of names given zero, one, or two-character context.

KotOR always uses the 28-character alphabet (a-z plus ' and -). Neverwinter Nights (NWN) used
26 characters; the header explicitly stores the count. This is a KotOR-specific difference from NWN.

LTR files are binary and consist of a short header followed by three probability tables
(singles, doubles, triples) stored as contiguous float arrays.

References:
- https://github.com/OldRepublicDevs/PyKotor/wiki/LTR-File-Format.md
- https://github.com/seedhartha/reone/blob/master/src/libs/resource/format/ltrreader.cpp:27-74
- https://github.com/xoreos/xoreos/blob/master/src/aurora/ltrfile.cpp:135-168
- https://github.com/KotOR-Community-Patches/KotOR.js/blob/master/src/resource/LTRObject.ts:61-117
</p>
<table class="table">
<tr><th>Offset</th><th>Size</th><th>ID</th><th>Type</th><th>Note</th></tr>
<tr>
<td>0</td>
<td>...</td>
<td>file_type</td>
<td>str(ASCII)</td>
<td>File type signature. Must be "LTR " (space-padded) for LTR files.</td>
</tr>
<tr>
<td>4</td>
<td>...</td>
<td>file_version</td>
<td>str(ASCII)</td>
<td>File format version. Must be "V1.0" for LTR files.</td>
</tr>
<tr>
<td>8</td>
<td>...</td>
<td>letter_count</td>
<td>u1</td>
<td>Number of characters in the alphabet. Must be 26 (NWN) or 28 (KotOR).
KotOR uses 28 characters: "abcdefghijklmnopqrstuvwxyz'-"
NWN uses 26 characters: "abcdefghijklmnopqrstuvwxyz"
</td>
</tr>
<tr>
<td>9</td>
<td>...</td>
<td>single_letter_block</td>
<td><a href="#type-ltr-letter_block">LetterBlock</a></td>
<td>Single-letter probability block (no context).
Used for generating the first character of names.
Contains start/middle/end probability arrays, each with letter_count floats.
Total size: letter_count × 3 × 4 bytes = 336 bytes for KotOR (28 chars).
</td>
</tr>
<tr>
<td>???</td>
<td>...</td>
<td>double_letter_blocks</td>
<td><a href="#type-ltr-double_letter_blocks_array">DoubleLetterBlocksArray</a></td>
<td>Double-letter probability blocks (1-character context).
Array of letter_count blocks, each indexed by the previous character.
Used for generating the second character based on the first character.
Each block contains start/middle/end probability arrays.
Total size: letter_count × 3 × letter_count × 4 bytes = 9,408 bytes for KotOR.
</td>
</tr>
<tr>
<td>???</td>
<td>...</td>
<td>triple_letter_blocks</td>
<td><a href="#type-ltr-triple_letter_blocks_array">TripleLetterBlocksArray</a></td>
<td>Triple-letter probability blocks (2-character context).
Two-dimensional array of letter_count × letter_count blocks.
Each block is indexed by the previous two characters.
Used for generating third and subsequent characters.
Each block contains start/middle/end probability arrays.
Total size: letter_count × letter_count × 3 × letter_count × 4 bytes = 73,472 bytes for KotOR.
</td>
</tr>
</table>
<a name='type-ltr-double_letter_blocks_array'></a>
<h2>Type: DoubleLetterBlocksArray</h2>

<p>Array of double-letter blocks. One block per character in the alphabet.
Each block is indexed by the previous character (context length 1).
</p>
<table class="table">
<tr><th>Offset</th><th>Size</th><th>ID</th><th>Type</th><th>Note</th></tr>
<tr>
<td>0</td>
<td>...</td>
<td>blocks</td>
<td><a href="#type-ltr-letter_block">LetterBlock</a></td>
<td>Array of letter_count blocks, each containing start/middle/end probability arrays.
Block index corresponds to the previous character in the alphabet.
</td>
</tr>
</table>
<a name='type-ltr-letter_block'></a>
<h2>Type: LetterBlock</h2>

<p>A probability block containing three arrays of probabilities (start, middle, end).
Each array has letter_count floats representing cumulative probabilities for each character
in the alphabet appearing at that position (start, middle, or end of name).

Blocks store cumulative probabilities (monotonically increasing floats) that are compared
against random roll values during name generation.
</p>
<table class="table">
<tr><th>Offset</th><th>Size</th><th>ID</th><th>Type</th><th>Note</th></tr>
<tr>
<td>0</td>
<td>...</td>
<td>start_probabilities</td>
<td>f4le</td>
<td>Array of start probabilities. One float per character in alphabet.
Probability of each letter starting a name (no context for singles,
after previous character for doubles, after previous two for triples).
</td>
</tr>
<tr>
<td>???</td>
<td>...</td>
<td>middle_probabilities</td>
<td>f4le</td>
<td>Array of middle probabilities. One float per character in alphabet.
Probability of each letter appearing in the middle of a name.
</td>
</tr>
<tr>
<td>???</td>
<td>...</td>
<td>end_probabilities</td>
<td>f4le</td>
<td>Array of end probabilities. One float per character in alphabet.
Probability of each letter ending a name.
</td>
</tr>
</table>
<a name='type-ltr-triple_letter_blocks_array'></a>
<h2>Type: TripleLetterBlocksArray</h2>

<p>Two-dimensional array of triple-letter blocks. letter_count × letter_count blocks total.
Each block is indexed by the previous two characters (context length 2).
</p>
<table class="table">
<tr><th>Offset</th><th>Size</th><th>ID</th><th>Type</th><th>Note</th></tr>
<tr>
<td>0</td>
<td>...</td>
<td>rows</td>
<td><a href="#type-ltr-triple_letter_row">TripleLetterRow</a></td>
<td>Array of letter_count rows, each containing letter_count blocks.
First index corresponds to the second-to-last character.
Second index corresponds to the last character.
</td>
</tr>
</table>
<a name='type-ltr-triple_letter_row'></a>
<h2>Type: TripleLetterRow</h2>

<p>A row in the triple-letter blocks array. Contains letter_count blocks,
each indexed by the last character in the two-character context.
</p>
<table class="table">
<tr><th>Offset</th><th>Size</th><th>ID</th><th>Type</th><th>Note</th></tr>
<tr>
<td>0</td>
<td>...</td>
<td>blocks</td>
<td><a href="#type-ltr-letter_block">LetterBlock</a></td>
<td>Array of letter_count blocks, each containing start/middle/end probability arrays.
Block index corresponds to the last character in the two-character context.
</td>
</tr>
</table>

  </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
  </body>
</html>
      
