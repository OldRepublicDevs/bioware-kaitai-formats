# This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

require 'kaitai/struct/struct'

unless Gem::Version.new(Kaitai::Struct::VERSION) >= Gem::Version.new('0.11')
  raise "Incompatible Kaitai Struct Ruby API: 0.11 or later is required, but you have #{Kaitai::Struct::VERSION}"
end


##
# NSS (NWScript Source) files contain human-readable NWScript source code
# that compiles to NCS bytecode. NWScript is the scripting language used
# in KotOR, TSL, and Neverwinter Nights.
# 
# NSS files are plain text files (typically Windows-1252 or UTF-8 encoding)
# containing NWScript source code. The nwscript.nss file defines all
# engine-exposed functions and constants available to scripts.
# 
# Format:
# - Plain text source code
# - May include BOM (Byte Order Mark) for UTF-8 files
# - Lines are typically terminated with CRLF (\r\n) or LF (\n)
# - Comments: // for single-line, /* */ for multi-line
# - Preprocessor directives: #include, #define, etc.
# 
# References:
# - https://github.com/OldRepublicDevs/PyKotor/wiki/NSS-File-Format.md
# - https://github.com/xoreos/xoreos-tools/tree/master/src/nwscript/ (NWScript compiler)
# - https://github.com/seedhartha/reone/blob/master/src/libs/script/ (Script execution engine)
class Nss < Kaitai::Struct::Struct
  def initialize(_io, _parent = nil, _root = nil)
    super(_io, _parent, _root || self)
    _read
  end

  def _read
    if _io.pos == 0
      @bom = @_io.read_u2le
      raise Kaitai::Struct::ValidationNotAnyOfError.new(@bom, @_io, "/seq/0") if not  ((@bom == 65279) || (@bom == 0)) 
    end
    @source_code = (@_io.read_bytes_full).force_encoding("UTF-8")
    self
  end

  ##
  # NWScript source code structure.
  # This is primarily a text format, so the main content is the source_code string.
  # 
  # The source can be parsed into:
  # - Tokens (keywords, identifiers, operators, literals)
  # - Statements (declarations, assignments, control flow)
  # - Functions (definitions with parameters and body)
  # - Preprocessor directives (#include, #define)
  class NssSource < Kaitai::Struct::Struct
    def initialize(_io, _parent = nil, _root = nil)
      super(_io, _parent, _root)
      _read
    end

    def _read
      @content = (@_io.read_bytes_full).force_encoding("UTF-8")
      self
    end

    ##
    # Complete source code content.
    attr_reader :content
  end

  ##
  # Optional UTF-8 BOM (Byte Order Mark) at the start of the file.
  # If present, will be 0xFEFF (UTF-8 BOM).
  # Most NSS files do not include a BOM.
  attr_reader :bom

  ##
  # Complete NWScript source code.
  # Contains function definitions, variable declarations, control flow
  # statements, and engine function calls.
  # 
  # Common elements:
  # - Function definitions: void function_name() { ... }
  # - Variable declarations: int variable_name;
  # - Control flow: if, while, for, switch
  # - Engine function calls: GetFirstObject(), GetObjectByTag(), etc.
  # - Constants: OBJECT_SELF, OBJECT_INVALID, etc.
  # 
  # The source code is compiled to NCS bytecode by the NWScript compiler.
  attr_reader :source_code
end
