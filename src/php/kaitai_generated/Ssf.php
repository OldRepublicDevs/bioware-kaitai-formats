<?php
// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild

/**
 * SSF (Sound Set File) files store sound string references (StrRefs) for character voice sets.
 * Each SSF file contains exactly 28 sound slots, mapping to different game events and actions.
 * 
 * Binary Format:
 * - Header (12 bytes): File type signature, version, and offset to sounds array
 * - Sounds Array (112 bytes): 28 uint32 values representing StrRefs (0xFFFFFFFF = -1 = no sound)
 * - Padding (12 bytes): 3 uint32 values of 0xFFFFFFFF (reserved/unused)
 * 
 * Total file size: 136 bytes (12 + 112 + 12)
 * 
 * Sound Slots (in order):
 * 0-5: Battle Cry 1-6
 * 6-8: Select 1-3
 * 9-11: Attack Grunt 1-3
 * 12-13: Pain Grunt 1-2
 * 14: Low Health
 * 15: Dead
 * 16: Critical Hit
 * 17: Target Immune
 * 18: Lay Mine
 * 19: Disarm Mine
 * 20: Begin Stealth
 * 21: Begin Search
 * 22: Begin Unlock
 * 23: Unlock Failed
 * 24: Unlock Success
 * 25: Separated From Party
 * 26: Rejoined Party
 * 27: Poisoned
 * 
 * References:
 * - https://github.com/OldRepublicDevs/PyKotor/blob/master/Libraries/PyKotor/src/pykotor/resource/formats/ssf/ssf_binary_reader.py
 * - https://github.com/OldRepublicDevs/PyKotor/blob/master/Libraries/PyKotor/src/pykotor/resource/formats/ssf/ssf_binary_writer.py
 */

namespace {
    class Ssf extends \Kaitai\Struct\Struct {
        public function __construct(\Kaitai\Struct\Stream $_io, ?\Kaitai\Struct\Struct $_parent = null, ?\Ssf $_root = null) {
            parent::__construct($_io, $_parent, $_root === null ? $this : $_root);
            $this->_read();
        }

        private function _read() {
            $this->_m_fileType = \Kaitai\Struct\Stream::bytesToStr($this->_io->readBytes(4), "ASCII");
            if (!($this->_m_fileType == "SSF ")) {
                throw new \Kaitai\Struct\Error\ValidationNotEqualError("SSF ", $this->_m_fileType, $this->_io, "/seq/0");
            }
            $this->_m_fileVersion = \Kaitai\Struct\Stream::bytesToStr($this->_io->readBytes(4), "ASCII");
            if (!($this->_m_fileVersion == "V1.1")) {
                throw new \Kaitai\Struct\Error\ValidationNotEqualError("V1.1", $this->_m_fileVersion, $this->_io, "/seq/1");
            }
            $this->_m_soundsOffset = $this->_io->readU4le();
            if (!($this->_m_soundsOffset == 12)) {
                throw new \Kaitai\Struct\Error\ValidationNotEqualError(12, $this->_m_soundsOffset, $this->_io, "/seq/2");
            }
            $this->_m_padding = new \Ssf\Padding($this->_io, $this, $this->_root);
        }
        protected $_m_sounds;

        /**
         * Array of 28 sound string references (StrRefs)
         */
        public function sounds() {
            if ($this->_m_sounds !== null)
                return $this->_m_sounds;
            $_pos = $this->_io->pos();
            $this->_io->seek($this->soundsOffset());
            $this->_m_sounds = new \Ssf\SoundArray($this->_io, $this, $this->_root);
            $this->_io->seek($_pos);
            return $this->_m_sounds;
        }
        protected $_m_fileType;
        protected $_m_fileVersion;
        protected $_m_soundsOffset;
        protected $_m_padding;

        /**
         * File type signature. Must be "SSF " (space-padded).
         * Bytes: 0x53 0x53 0x46 0x20
         */
        public function fileType() { return $this->_m_fileType; }

        /**
         * File format version. Always "V1.1" for KotOR SSF files.
         * Bytes: 0x56 0x31 0x2E 0x31
         */
        public function fileVersion() { return $this->_m_fileVersion; }

        /**
         * Byte offset to the sounds array from the beginning of the file.
         * Always 12 (0x0C) in valid SSF files, as the sounds array immediately follows the header.
         * This field exists for format consistency, though it's always the same value.
         */
        public function soundsOffset() { return $this->_m_soundsOffset; }

        /**
         * Reserved padding bytes (12 bytes of 0xFFFFFFFF)
         */
        public function padding() { return $this->_m_padding; }
    }
}

namespace Ssf {
    class Padding extends \Kaitai\Struct\Struct {
        public function __construct(\Kaitai\Struct\Stream $_io, ?\Ssf $_parent = null, ?\Ssf $_root = null) {
            parent::__construct($_io, $_parent, $_root);
            $this->_read();
        }

        private function _read() {
            $this->_m_paddingBytes = [];
            $n = 3;
            for ($i = 0; $i < $n; $i++) {
                $this->_m_paddingBytes[] = $this->_io->readU4le();
            }
        }
        protected $_m_paddingBytes;

        /**
         * Reserved padding bytes. Always 3 uint32 values of 0xFFFFFFFF.
         * Total size: 12 bytes (3 * 4 bytes).
         * These bytes are unused but must be present for format compatibility.
         * Each padding byte should be 0xFFFFFFFF (4294967295).
         */
        public function paddingBytes() { return $this->_m_paddingBytes; }
    }
}

namespace Ssf {
    class SoundArray extends \Kaitai\Struct\Struct {
        public function __construct(\Kaitai\Struct\Stream $_io, ?\Ssf $_parent = null, ?\Ssf $_root = null) {
            parent::__construct($_io, $_parent, $_root);
            $this->_read();
        }

        private function _read() {
            $this->_m_entries = [];
            $n = 28;
            for ($i = 0; $i < $n; $i++) {
                $this->_m_entries[] = new \Ssf\SoundEntry($this->_io, $this, $this->_root);
            }
        }
        protected $_m_entries;

        /**
         * Array of exactly 28 sound entries, one for each SSFSound enum value.
         * Each entry is a uint32 representing a StrRef (string reference).
         * Value 0xFFFFFFFF (4294967295) represents -1 (no sound assigned).
         * 
         * Entry indices map to SSFSound enum:
         * - 0-5: Battle Cry 1-6
         * - 6-8: Select 1-3
         * - 9-11: Attack Grunt 1-3
         * - 12-13: Pain Grunt 1-2
         * - 14: Low Health
         * - 15: Dead
         * - 16: Critical Hit
         * - 17: Target Immune
         * - 18: Lay Mine
         * - 19: Disarm Mine
         * - 20: Begin Stealth
         * - 21: Begin Search
         * - 22: Begin Unlock
         * - 23: Unlock Failed
         * - 24: Unlock Success
         * - 25: Separated From Party
         * - 26: Rejoined Party
         * - 27: Poisoned
         */
        public function entries() { return $this->_m_entries; }
    }
}

namespace Ssf {
    class SoundEntry extends \Kaitai\Struct\Struct {
        public function __construct(\Kaitai\Struct\Stream $_io, ?\Ssf\SoundArray $_parent = null, ?\Ssf $_root = null) {
            parent::__construct($_io, $_parent, $_root);
            $this->_read();
        }

        private function _read() {
            $this->_m_strrefRaw = $this->_io->readU4le();
        }
        protected $_m_isNoSound;

        /**
         * True if this entry represents "no sound" (0xFFFFFFFF).
         * False if this entry contains a valid StrRef value.
         */
        public function isNoSound() {
            if ($this->_m_isNoSound !== null)
                return $this->_m_isNoSound;
            $this->_m_isNoSound = $this->strrefRaw() == 4294967295;
            return $this->_m_isNoSound;
        }
        protected $_m_strrefRaw;

        /**
         * Raw uint32 value representing the StrRef.
         * Value 0xFFFFFFFF (4294967295) represents -1 (no sound assigned).
         * All other values are valid StrRefs (typically 0-999999).
         * The conversion from 0xFFFFFFFF to -1 is handled by SSFBinaryReader.ReadInt32MaxNeg1().
         */
        public function strrefRaw() { return $this->_m_strrefRaw; }
    }
}
